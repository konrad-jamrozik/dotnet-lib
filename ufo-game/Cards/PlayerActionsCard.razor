@using UfoGame.Cards.Components
@using UfoGame.Model
@using System.Diagnostics.CodeAnalysis
@using UfoGame.Model.Data
@inject Timeline Timeline
@inject Research Research
@inject Accounting Accounting
@inject PendingMission PendingMission
@inject PlayerScore PlayerScore
@inject ViewModel.RaiseMoneyPlayerAction RaiseMoney
@inject ViewModel.ResearchMoneyRaisingMethodsPlayerAction ResearchMoneyRaisingMethods
@inject ViewModel.ResearchAgentEffectivenessPlayerAction ResearchAgentEffectiveness
@inject ViewModel.ResearchAgentSurvivabilityPlayerAction ResearchAgentSurvivability
@inject ViewModel.ResearchTransportCapacityPlayerAction ResearchTransportCapacity
@inject ViewModel.ResearchAgentRecoverySpeedPlayerAction ResearchAgentRecoverySpeed
@inject ViewModel.DoNothingPlayerAction DoNothing

<Card Title="Actions">
    <CardDataRow Label="Current time" Value="Timeline.Data.CurrentTime" />
    <div class="row">
        <CardButton2 PlayerAction="RaiseMoney" />
        <CardButton2 PlayerAction="ResearchMoneyRaisingMethods" />
    </div>
    <div class="row">
        <CardButton2 PlayerAction="ResearchAgentEffectiveness" />
        <CardButton2 PlayerAction="ResearchAgentSurvivability" />
    </div>
    <div class="row">
        <CardButton2 PlayerAction="ResearchTransportCapacity" />
        <CardButton2 PlayerAction="ResearchAgentRecoverySpeed" />
    </div>
    <div class="row">
        <CardButton2 PlayerAction="DoNothing" />
    </div>
    <div class="row mt-2 @(WarningMessagePresent ? "visible" : "invisible") ">
        <div class="col @(PlayerScore.PlayerWon ? "text-success": "text-danger")">
            @WarningMessage()
        </div>
    </div>
</Card>

@code
{
    private bool WarningMessagePresent => PlayerScore.GameOver || PendingMission.MissionAboutToExpire;

    private string WarningMessage()
    {
        if (PlayerScore.GameOver)
            return "GAME OVER! " 
                   + (PlayerScore.PlayerWon 
                       ? $"YOU WON! Score: {PlayerScore.Data.Value}. Turn: {Timeline.Data.CurrentTime}" 
                       : $"YOU LOST! Lasted until turn: {Timeline.Data.CurrentTime}.");
        else if (PendingMission.MissionAboutToExpire)
            return $"If you don't launch mission now, you will lose {PlayerScore.IgnoreMissionScoreLoss} score for ignoring pending mission!";
        else
            return "If you don't launch mission now, you will lose 1000 score for ignoring pending mission!";
    }

}
