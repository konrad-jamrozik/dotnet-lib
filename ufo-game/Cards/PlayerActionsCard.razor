@using UfoGame.Cards.Components
@using UfoGame.Model
@using System.Diagnostics.CodeAnalysis
@using UfoGame.Model.Data
@inject Game Game;

<Card Title="Actions">
    <CardDataRow Label="Current time" Value="Game.Timeline.CurrentTime" />
    <div class="row">
        <CardButton Enabled="Game.CanRaiseMoney()"
                    OnClick="Game.RaiseMoney">
            Raise money: $@Game.Money.Data.MoneyRaisedPerActionAmount
        </CardButton>
        <CardButton Enabled="Game.CanResearchMoneyRaisingMethods()"
                    OnClick="Game.ResearchMoneyRaisingMethods">
            Research money raising methods for $@Game.Research.MoneyRaisingMethodsResearchCost
        </CardButton>
    </div>
    <div class="row">
        <CardButton Enabled="Game.CanResearchAgentEffectiveness()"
                    OnClick="Game.ResearchAgentEffectiveness">
            Research agent effectiveness for $@Game.Research.AgentEffectivenessResearchCost
        </CardButton>
        <CardButton Enabled="Game.CanResearchAgentSurvivability()"
                    OnClick="Game.ResearchAgentSurvivability">
            Research agent survivability for $@Game.Research.AgentSurvivabilityResearchCost
        </CardButton>
    </div>
    <div class="row">
        <CardButton Enabled="Game.CanResearchTransportCapacity()"
                    OnClick="Game.ResearchTransportCapacity">
            Increase transport capacity by @MissionPrepData.TransportCapacityImprovement for $@Game.Research.TransportCapacityResearchCost
        </CardButton>
        <CardButton Enabled="Game.CanResearchAgentRecoverySpeed()"
                    OnClick="Game.ResearchAgentRecoverySpeed">
            Increase agent recovery speed by @StaffData.AgentRecoverySpeedImprovement for $@Game.Research.AgentRecoverySpeedResearchCost
        </CardButton>
    </div>
    <div class="row">
        <CardButton Enabled="Game.CanDoNothing()"
                    OnClick="Game.DoNothing">
            Do nothing & advance time
        </CardButton>
    </div>
    <div class="row mt-2 @(WarningMessagePresent ? "visible" : "invisible") ">
        <div class="col @(Game.PlayerScore.PlayerWon ? "text-success": "text-danger")">
            @WarningMessage()
        </div>
    </div>
</Card>

@code
{
    private bool WarningMessagePresent => Game.PlayerScore.GameOver || Game.PendingMission.MissionAboutToExpire;

    private string WarningMessage()
    {
        if (Game.PlayerScore.GameOver)
            return "GAME OVER! " 
                   + (Game.PlayerScore.PlayerWon 
                       ? $"YOU WON! Score: {Game.PlayerScore.Data.Value}. Turn: {Game.Timeline.CurrentTime}" 
                       : $"YOU LOST! Lasted until turn: {Game.Timeline.CurrentTime}.");
        else if (Game.PendingMission.MissionAboutToExpire)
            return $"If you don't launch mission now, you will lose {PlayerScore.IgnoreMissionScoreLoss} score for ignoring pending mission!";
        else
            return "If you don't launch mission now, you will lose 1000 score for ignoring pending mission!";
    }

}
