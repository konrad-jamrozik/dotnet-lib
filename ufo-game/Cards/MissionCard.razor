@using UfoGame.Cards.Components
@using UfoGame.Model
@inject Game Game;
@inject ViewModel.LaunchMissionPlayerAction LaunchMission;

<Card Title="Mission">
    <CardDataRow Text="Available in" 
                 Value="@Game.PendingMission.Data.AvailableIn" 
                 Enabled="@(!Game.PendingMission.CurrentlyAvailable)" />
    <CardDataRow Text="Expires in" 
                 Value="@Game.PendingMission.Data.ExpiresIn"
                 Enabled="@Game.PendingMission.CurrentlyAvailable"
                 ValueCssClass="@(Game.PendingMission.MissionAboutToExpire ? "text-danger" : "")"/>
    <CardDataRow Text="Enemy faction"
                 Value="@Game.PendingMission.Faction.Name"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Money reward"
                 Value="@("$"+Game.PendingMission.MoneyReward)"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Enemy power"
                 Value="@Game.PendingMission.EnemyPower"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Our power"
                 Value="@Game.PendingMission.OurPower"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Mission success %"
                 Value="@(Game.PendingMission.SuccessChance + "%")"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Baseline sol. surv. %"
                 Value="@(Game.PendingMission.BaselineAgentSurvivalChance + "%")"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Transport capacity"
                 Value="@Game.MissionPrep.Data.TransportCapacity"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardDataRow Text="Ready agents"
                 Value="Game.Staff.Data.AgentsSendableOnMissionCount"
                 ValueCssClass="text-success" />
    <CardDataRow Text="Agents to send" 
                 Value="@Game.Staff.Data.AgentsAssignedToMissionCount"
                 Enabled="@Game.PendingMission.CurrentlyAvailable" />
    <CardButtonWithRangeInput PlayerAction="LaunchMission" />
    <div class="row">
        <div class="col">Last mission debriefing:</div>
    </div>
    <div class="row">
        <div class="col @GetLastMissionReportCssClass()">
            @Game.Archive.LastMissionReport
        </div>
    </div>
</Card>

@code
{
    private string GetLastMissionReportCssClass()
    {
        var report = Game.Archive.LastMissionReport;

        if (report == Archive.NoMissionsReport)
            return "";

        return report.Contains("successful") ? "text-success" : "text-danger";
    }
}